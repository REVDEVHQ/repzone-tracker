<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RepZone Pro</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; width: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
  .leaflet-container { height: 100% !important; width: 100% !important; }
  .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
  .tracking-indicator { animation: pulse 2s infinite; }
  .tab { padding: 0.75rem 1rem; cursor: pointer; border-bottom: 2px solid transparent; font-weight: 500; transition: all 0.2s; }
  .tab.active { border-bottom-color: #2563eb; color: #2563eb; }
  .tab:hover { background: #f1f5f9; }
</style>
</head>
<body>
<div id="root"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

const SUPABASE_URL = 'https://cytikhfyygkovnjtpsth.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5dGlraGZ5eWdrb3ZuanRwc3RoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTc3NzYsImV4cCI6MjA3NjI5Mzc3Nn0.ItJObIXo_Ks8TEigj5RkUA4vXbze_3FMMIzYyVHrthQ';

const COLORS = ["#ef4444", "#3b82f6", "#10b981", "#f59e0b", "#8b5cf6", "#ec4899"];

function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371e3;
  const φ1 = lat1 * Math.PI / 180;
  const φ2 = lat2 * Math.PI / 180;
  const Δφ = (lat2 - lat1) * Math.PI / 180;
  const Δλ = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ/2) * Math.sin(Δλ/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c * 3.28084;
}

function getVerificationStatus(distance) {
  if (distance <= 50) return { status: 'verified', color: '#10b981', icon: '✅', label: 'Verified' };
  if (distance <= 150) return { status: 'questionable', color: '#f59e0b', icon: '⚠️', label: 'Questionable' };
  return { status: 'suspicious', color: '#ef4444', icon: '🚫', label: 'Suspicious' };
}

function RepZoneApp() {
  const [pins, setPins] = useState([]);
  const [zones, setZones] = useState([]);
  const [teamMembers, setTeamMembers] = useState([]);
  const [liveLocations, setLiveLocations] = useState([]);
  const [currentUser, setCurrentUser] = useState(null);
  const [currentLocation, setCurrentLocation] = useState(null);
  const [mode, setMode] = useState("drop-pin");
  const [status, setStatus] = useState("knocked");
  const [activeZoneId, setActiveZoneId] = useState(null);
  const [note, setNote] = useState("");
  const [filter, setFilter] = useState({ status: "all", userId: "all" });
  const [activeTab, setActiveTab] = useState("map");
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [mapReady, setMapReady] = useState(false);
  const [showUserModal, setShowUserModal] = useState(false);
  const [newUserName, setNewUserName] = useState("");
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
  const [leaderboardPeriod, setLeaderboardPeriod] = useState('week');
  const [trackingEnabled, setTrackingEnabled] = useState(false);
  const [showLiveTracking, setShowLiveTracking] = useState(true);
  
  const mapRef = useRef(null);
  const mapInstanceRef = useRef(null);
  const supabase = useRef(null);
  const locationWatchId = useRef(null);
  const locationUpdateInterval = useRef(null);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth < 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  useEffect(() => {
    supabase.current = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    loadData();
    const saved = localStorage.getItem('current_user_id');
    if (saved) {
      const user = JSON.parse(saved);
      setCurrentUser(user);
      requestLocationPermission(user);
    }
  }, []);

  useEffect(() => {
    if (!supabase.current) return;
    loadLiveLocations();
    const interval = setInterval(loadLiveLocations, 10000);
    return () => clearInterval(interval);
  }, []);

  async function loadLiveLocations() {
    try {
      const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000).toISOString();
      const { data, error } = await supabase.current
        .from('live_locations')
        .select('*')
        .gte('last_updated', fiveMinutesAgo)
        .eq('is_active', true);
      if (!error && data) setLiveLocations(data);
    } catch (e) {
      console.error('Error loading live locations:', e);
    }
  }

  async function requestLocationPermission(user) {
    if (!navigator.geolocation) {
      alert('Geolocation is not supported');
      return;
    }
    navigator.geolocation.getCurrentPosition(
      () => startLocationTracking(user),
      (error) => console.error('Location permission denied:', error)
    );
  }

  function startLocationTracking(user) {
    if (!user || locationWatchId.current) return;
    setTrackingEnabled(true);
    locationWatchId.current = navigator.geolocation.watchPosition(
      (position) => {
        const newLocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude,
          accuracy: position.coords.accuracy
        };
        setCurrentLocation(newLocation);
      },
      (error) => console.error('Tracking error:', error),
      { enableHighAccuracy: true, maximumAge: 10000, timeout: 5000 }
    );
    locationUpdateInterval.current = setInterval(() => {
      if (currentLocation && user) {
        updateLiveLocation(user.id, currentLocation);
      }
    }, 30000);
  }

  function stopLocationTracking() {
    if (locationWatchId.current) {
      navigator.geolocation.clearWatch(locationWatchId.current);
      locationWatchId.current = null;
    }
    if (locationUpdateInterval.current) {
      clearInterval(locationUpdateInterval.current);
      locationUpdateInterval.current = null;
    }
    setTrackingEnabled(false);
    if (currentUser) {
      supabase.current
        .from('live_locations')
        .update({ is_active: false })
        .eq('team_member_id', currentUser.id)
        .then(() => {});
    }
  }

  async function updateLiveLocation(userId, location) {
    try {
      const locationData = {
        id: `loc-${userId}-${Date.now()}`,
        team_member_id: userId,
        lat: location.lat,
        lng: location.lng,
        accuracy: location.accuracy,
        last_updated: new Date().toISOString(),
        is_active: true
      };
      await supabase.current
        .from('live_locations')
        .upsert(locationData, { onConflict: 'team_member_id' });
      loadLiveLocations();
    } catch (e) {
      console.error('Error updating location:', e);
    }
  }

  useEffect(() => {
    if (currentLocation && currentUser && trackingEnabled) {
      updateLiveLocation(currentUser.id, currentLocation);
    }
  }, [currentLocation, currentUser, trackingEnabled]);

  useEffect(() => {
    return () => stopLocationTracking();
  }, []);

  async function loadData() {
    try {
      const [pinsRes, zonesRes, teamRes] = await Promise.all([
        supabase.current.from('pins').select('*'),
        supabase.current.from('zones').select('*'),
        supabase.current.from('team_members').select('*')
      ]);
      setPins(pinsRes.data || []);
      setZones(zonesRes.data || []);
      setTeamMembers(teamRes.data || []);
    } catch (e) {
      console.error('Load error:', e);
    }
    setLoading(false);
  }

  async function deletePin(pinId) {
    if (!confirm('Delete this pin?')) return;
    await supabase.current.from('pins').delete().eq('id', pinId);
    setPins(prev => prev.filter(p => p.id !== pinId));
  }

  async function updatePinStatus(pinId, newStatus) {
    await supabase.current.from('pins').update({ status: newStatus }).eq('id', pinId);
    setPins(prev => prev.map(p => p.id === pinId ? {...p, status: newStatus} : p));
  }

  useEffect(() => {
    window.deletePinGlobal = deletePin;
    window.updatePinStatusGlobal = updatePinStatus;
    return () => {
      delete window.deletePinGlobal;
      delete window.updatePinStatusGlobal;
    };
  }, []);

  async function addTeamMember() {
    if (!newUserName.trim()) return;
    const newMember = {
      id: `user-${Date.now()}`,
      name: newUserName,
      color: COLORS[teamMembers.length % COLORS.length],
      role: 'rep',
      created_at: new Date().toISOString()
    };
    await supabase.current.from('team_members').insert([newMember]);
    setTeamMembers(prev => [...prev, newMember]);
    setNewUserName("");
    setShowUserModal(false);
  }

  function selectCurrentUser(user) {
    setCurrentUser(user);
    localStorage.setItem('current_user_id', JSON.stringify(user));
    requestLocationPermission(user);
  }

  function getLeaderboard() {
    const now = new Date();
    const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
    startOfWeek.setHours(0, 0, 0, 0);
    const startOfDay = new Date();
    startOfDay.setHours(0, 0, 0, 0);

    return teamMembers.map(member => {
      const memberPins = pins.filter(p => p.team_member_id === member.id);
      const weekPins = memberPins.filter(p => new Date(p.created_at) >= startOfWeek);
      const dayPins = memberPins.filter(p => new Date(p.created_at) >= startOfDay);
      
      let count = 0;
      if (leaderboardPeriod === 'week') count = weekPins.filter(p => p.status === 'knocked').length;
      else if (leaderboardPeriod === 'day') count = dayPins.filter(p => p.status === 'knocked').length;
      else count = memberPins.filter(p => p.status === 'knocked').length;

      const liveLocation = liveLocations.find(l => l.team_member_id === member.id);
      const isOnline = liveLocation && new Date(liveLocation.last_updated) > new Date(Date.now() - 5 * 60 * 1000);

      return { ...member, knockCount: count, isOnline, liveLocation };
    }).sort((a, b) => b.knockCount - a.knockCount);
  }

  // Map initialization
  useEffect(() => {
    if (!mapRef.current || mapInstanceRef.current || loading) return;
    
    const map = L.map(mapRef.current, {
      center: [47.6062, -122.3321],
      zoom: isMobile ? 12 : 13,
      zoomControl: !isMobile
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(map);

    if (isMobile) {
      L.control.zoom({ position: 'bottomright' }).addTo(map);
    }

    mapInstanceRef.current = map;
    
    setTimeout(() => {
      map.invalidateSize();
      setMapReady(true);
    }, 300);
  }, [loading, isMobile]);

  // Map click handlers
  useEffect(() => {
    const map = mapInstanceRef.current;
    if (!map || !mapReady) return;

    const handleClick = async (e) => {
      const { lat, lng } = e.latlng;
      
      if (mode === "drop-pin" && currentUser) {
        if (!currentLocation) {
          alert('Unable to verify location. Please enable location services.');
          return;
        }

        setSaving(true);
        const distance = calculateDistance(currentLocation.lat, currentLocation.lng, lat, lng);
        const verification = getVerificationStatus(distance);

        const newPin = {
          id: `pin-${Date.now()}`,
          lat, lng, status,
          rep_name: currentUser.name,
          team_member_id: currentUser.id,
          note: note || null,
          actual_lat: currentLocation.lat,
          actual_lng: currentLocation.lng,
          distance_from_pin: Math.round(distance),
          verification_status: verification.status,
          created_at: new Date().toISOString()
        };
        
        await supabase.current.from('pins').insert([newPin]);
        setPins(prev => [...prev, newPin]);
        setNote("");
        setSaving(false);

        if (verification.status === 'suspicious') {
          alert(`⚠️ Warning: You are ${Math.round(distance)} feet away from this location. This pin has been flagged as suspicious.`);
        }
      } else if (mode === "draw-zone") {
        const id = activeZoneId || `zone-${Date.now()}`;
        const existing = zones.find(z => z.id === id);
        const newPoints = existing ? [...existing.points, [lat, lng]] : [[lat, lng]];
        
        if (existing) {
          await supabase.current.from('zones').update({ points: newPoints }).eq('id', id);
          setZones(prev => prev.map(z => z.id === id ? {...z, points: newPoints} : z));
        } else {
          const newZone = {
            id, name: `Zone ${zones.length + 1}`,
            color: COLORS[zones.length % COLORS.length],
            points: newPoints,
            created_by: currentUser?.name || 'Admin',
            created_at: new Date().toISOString()
          };
          await supabase.current.from('zones').insert([newZone]);
          setZones(prev => [...prev, newZone]);
        }
        setActiveZoneId(id);
      }
    };

    map.on('click', handleClick);
    map.on('dblclick', () => {
      if (mode === "draw-zone" && activeZoneId) {
        setActiveZoneId(null);
        setMode("select");
      }
    });

    return () => map.off('click', handleClick);
  }, [mode, status, note, activeZoneId, zones, mapReady, currentUser, currentLocation]);

  // Render map layers
  useEffect(() => {
    const map = mapInstanceRef.current;
    if (!map || !mapReady) return;

    map.eachLayer(layer => {
      if (layer instanceof L.Polygon || layer instanceof L.Marker || layer instanceof L.Circle) {
        map.removeLayer(layer);
      }
    });

    // Draw zones
    zones.forEach(zone => {
      if (zone.points?.length >= 3) {
        const assigned = teamMembers.find(u => u.id === zone.assigned_to);
        L.polygon(zone.points, {
          color: assigned?.color || zone.color,
          fillColor: assigned?.color || zone.color,
          fillOpacity: 0.2,
          weight: 3
        }).addTo(map).bindPopup(`
          <div style="padding:8px;min-width:150px">
            <b style="font-size:16px">${zone.name}</b><br>
            ${assigned ? `<span style="color:${assigned.color}">👤 ${assigned.name}</span>` : '⚠️ Unassigned'}
          </div>
        `);
      }
    });

    // Draw live locations
    if (showLiveTracking) {
      liveLocations.forEach(loc => {
        const member = teamMembers.find(m => m.id === loc.team_member_id);
        if (!member || loc.team_member_id === currentUser?.id) return;

        const minutesAgo = Math.floor((Date.now() - new Date(loc.last_updated)) / 60000);
        const isRecent = minutesAgo < 5;

        L.circle([loc.lat, loc.lng], {
          radius: 30,
          color: member.color,
          fillColor: member.color,
          fillOpacity: isRecent ? 0.4 : 0.2,
          weight: 3,
          className: isRecent ? 'tracking-indicator' : ''
        }).addTo(map);

        const liveIcon = L.divIcon({
          html: `<div style="background:${member.color};width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:1.125rem;border:4px solid white;box-shadow:0 2px 12px rgba(0,0,0,0.3);position:relative">${member.name.charAt(0)}${isRecent ? `<div style="position:absolute;top:-4px;right:-4px;width:12px;height:12px;background:#10b981;border:2px solid white;border-radius:50%"></div>` : ''}</div>`,
          iconSize: [40, 40],
          iconAnchor: [20, 20],
          className: ''
        });

        L.marker([loc.lat, loc.lng], { icon: liveIcon }).addTo(map);
      });
    }

    // Draw current user location
    if (currentLocation && currentUser) {
      L.circle([currentLocation.lat, currentLocation.lng], {
        radius: 50,
        color: currentUser.color,
        fillColor: currentUser.color,
        fillOpacity: 0.3,
        weight: 2,
        className: 'tracking-indicator'
      }).addTo(map);

      const youIcon = L.divIcon({
        html: `<div style="background:${currentUser.color};width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:1.25rem;border:4px solid white;box-shadow:0 4px 16px rgba(0,0,0,0.4);position:relative">${currentUser.name.charAt(0)}<div style="position:absolute;top:-6px;right:-6px;width:16px;height:16px;background:#10b981;border:3px solid white;border-radius:50%;animation:pulse 2s infinite"></div></div>`,
        iconSize: [48, 48],
        iconAnchor: [24, 24],
        className: ''
      });

      L.marker([currentLocation.lat, currentLocation.lng], { icon: youIcon })
        .addTo(map)
        .bindPopup(`<div style="padding:8px;text-align:center"><b style="color:${currentUser.color};font-size:1.125rem">📍 You Are Here</b><br><small style="color:#64748b">Tracking Active</small></div>`);
    }

    // Draw pins
    const filtered = pins.filter(p => {
      if (filter.status !== "all" && p.status !== filter.status) return false;
      if (filter.userId !== "all" && p.team_member_id !== filter.userId) return false;
      return true;
    });

    filtered.forEach(pin => {
      const user = teamMembers.find(u => u.id === pin.team_member_id);
      const icons = { knocked: "✅", flyer: "📬", skipped: "⏭️" };
      const verification = pin.verification_status ? getVerificationStatus(pin.distance_from_pin || 0) : null;
      
      const icon = L.divIcon({
        html: `<div style="background:${user?.color || '#64748b'};width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;border:3px solid ${verification ? verification.color : 'white'};box-shadow:0 2px 8px rgba(0,0,0,0.3);position:relative">${icons[pin.status]}${verification ? `<div style="position:absolute;top:-8px;right:-8px;background:${verification.color};color:white;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:12px;border:2px solid white">${verification.icon}</div>` : ''}</div>`,
        iconSize: [36, 36],
        iconAnchor: [18, 36],
        className: ''
      });
      
      const marker = L.marker([pin.lat, pin.lng], { icon }).addTo(map);
      
      marker.bindPopup(`
        <div style="min-width:200px;padding:12px">
          <div style="font-size:20px;margin-bottom:8px">${icons[pin.status]} <b>${pin.status.toUpperCase()}</b></div>
          <div style="padding:8px;background:${user?.color || '#64748b'}22;border-left:3px solid ${user?.color || '#64748b'};margin-bottom:8px">
            <b>👤 ${pin.rep_name || 'Unknown'}</b>
          </div>
          ${pin.note ? `<div style="font-size:13px;margin-bottom:8px">📝 ${pin.note}</div>` : ''}
          ${verification ? `
            <div style="padding:8px;background:${verification.color}22;border-left:3px solid ${verification.color};margin-bottom:8px;border-radius:4px">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
                <span style="font-size:20px">${verification.icon}</span>
                <b style="color:${verification.color}">${verification.label}</b>
              </div>
              <div style="font-size:12px;color:#64748b">
                <b>${pin.distance_from_pin} feet</b> from actual location
              </div>
            </div>
          ` : ''}
          <div style="font-size:11px;color:#64748b;margin-bottom:12px">${new Date(pin.created_at).toLocaleString()}</div>
          <div style="display:flex;gap:8px;padding-top:8px;border-top:2px solid #e2e8f0">
            <button onclick="window.updatePinStatusGlobal('${pin.id}', 'knocked')" style="flex:1;padding:8px;background:#16a34a;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px">✅</button>
            <button onclick="window.updatePinStatusGlobal('${pin.id}', 'flyer')" style="flex:1;padding:8px;background:#2563eb;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px">📬</button>
          </div>
          <button onclick="window.deletePinGlobal('${pin.id}')" style="width:100%;margin-top:8px;padding:8px;background:#ef4444;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px">🗑️ Delete Pin</button>
        </div>
      `);
    });
  }, [pins, zones, filter, mapReady, teamMembers, liveLocations, currentLocation, currentUser, showLiveTracking]);

  if (loading) {
    return (
      <div style={{display:'flex',alignItems:'center',justifyContent:'center',height:'100vh',flexDirection:'column',gap:'1rem',background:'#f8fafc'}}>
        <div className="spinner"></div>
        <p style={{color:'#64748b',fontWeight:'500'}}>Loading RepZone...</p>
      </div>
    );
  }

  const stats = {
    totalPins: pins.length,
    knocked: pins.filter(p => p.status === 'knocked').length,
    flyers: pins.filter(p => p.status === 'flyer').length,
    verified: pins.filter(p => p.verification_status === 'verified').length,
    suspicious: pins.filter(p => p.verification_status === 'suspicious').length,
    onlineUsers: liveLocations.filter(l => new Date(l.last_updated) > new Date(Date.now() - 5 * 60 * 1000)).length
  };

  const leaderboard = getLeaderboard();

  const LeaderboardView = () => (
    <div style={{padding:'1rem'}}>
      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'1rem'}}>
        <h2 style={{fontSize:'1.5rem',fontWeight:'bold'}}>🏆 Leaderboard</h2>
      </div>

      <div style={{display:'flex',gap:'0.5rem',marginBottom:'1.5rem',background:'#f1f5f9',padding:'0.25rem',borderRadius:'0.75rem'}}>
        {[['day','Today'],['week','This Week'],['all','All Time']].map(([period, label]) => (
          <button key={period} onClick={() => setLeaderboardPeriod(period)} style={{flex:1,padding:'0.75rem',borderRadius:'0.5rem',border:'none',background:leaderboardPeriod===period?'white':'transparent',color:leaderboardPeriod===period?'#1e293b':'#64748b',fontWeight:'600',cursor:'pointer',fontSize:'0.875rem',boxShadow:leaderboardPeriod===period?'0 1px 3px rgba(0,0,0,0.1)':'none',transition:'all 0.2s'}}>
            {label}
          </button>
        ))}
      </div>

      <div style={{display:'flex',flexDirection:'column',gap:'1rem'}}>
        {leaderboard.map((member, index) => (
          <div key={member.id} style={{padding:'1.25rem',background:index===0?`linear-gradient(135deg, ${member.color}22 0%, ${member.color}11 100%)`:index===1?'#f8fafc':'white',borderRadius:'1rem',border:index===0?`3px solid ${member.color}`:index===1?'2px solid #e2e8f0':'1px solid #e2e8f0',display:'flex',alignItems:'center',gap:'1rem',position:'relative',boxShadow:index===0?'0 4px 12px rgba(0,0,0,0.1)':index===1?'0 2px 8px rgba(0,0,0,0.05)':'none'}}>
            {index < 3 && (
              <div style={{position:'absolute',top:'-12px',left:'-12px',width:'40px',height:'40px',borderRadius:'50%',background:index===0?'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)':index===1?'linear-gradient(135deg, #94a3b8 0%, #64748b 100%)':'linear-gradient(135deg, #fb923c 0%, #ea580c 100%)',display:'flex',alignItems:'center',justifyContent:'center',color:'white',fontWeight:'bold',fontSize:'1.125rem',boxShadow:'0 2px 8px rgba(0,0,0,0.2)'}}>
                {index===0?'🥇':index===1?'🥈':'🥉'}
              </div>
            )}
            <div style={{fontSize:'2rem',fontWeight:'bold',color:index<3?member.color:'#94a3b8',width:'40px',textAlign:'center'}}>
              {index>=3?`#${index+1}`:''}
            </div>
            <div style={{width:'56px',height:'56px',borderRadius:'50%',background:member.color,display:'flex',alignItems:'center',justifyContent:'center',color:'white',fontWeight:'bold',fontSize:'1.5rem',flexShrink:0,boxShadow:'0 2px 8px rgba(0,0,0,0.15)',position:'relative'}}>
              {member.name.charAt(0)}
              {member.isOnline && (
                <div style={{position:'absolute',top:'-4px',right:'-4px',width:'18px',height:'18px',background:'#10b981',border:'3px solid white',borderRadius:'50%'}}></div>
              )}
            </div>
            <div style={{flex:1}}>
              <div style={{display:'flex',alignItems:'center',gap:'0.5rem',marginBottom:'0.25rem'}}>
                <span style={{fontWeight:'bold',fontSize:'1.125rem'}}>{member.name}</span>
                {member.isOnline && (
                  <span style={{fontSize:'0.625rem',padding:'0.25rem 0.5rem',background:'#10b981',color:'white',borderRadius:'1rem',fontWeight:'600'}}>● ONLINE</span>
                )}
              </div>
              <div style={{fontSize:'0.75rem',color:'#64748b'}}>
                {member.knockCount} doors knocked
              </div>
            </div>
            <div style={{fontSize:'2.5rem',fontWeight:'bold',color:member.color,textAlign:'right'}}>
              {member.knockCount}
            </div>
          </div>
        ))}
      </div>

      {leaderboard.length === 0 && (
        <div style={{textAlign:'center',padding:'3rem',color:'#64748b'}}>
          <div style={{fontSize:'3rem',marginBottom:'1rem'}}>🏆</div>
          <p style={{fontSize:'1.125rem',fontWeight:'600',marginBottom:'0.5rem'}}>No data yet</p>
          <p style={{fontSize:'0.875rem'}}>Start knocking doors to see rankings!</p>
        </div>
      )}
    </div>
  );

  return (
    <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'#f8fafc'}}>
      {saving && (
        <div style={{position:'fixed',top:'1rem',left:'50%',transform:'translateX(-50%)',background:'white',padding:'0.75rem 1.5rem',borderRadius:'2rem',boxShadow:'0 4px 12px rgba(0,0,0,0.15)',zIndex:10001,display:'flex',gap:'0.75rem',alignItems:'center'}}>
          <div className="spinner" style={{width:'20px',height:'20px'}}></div>
          <span style={{fontWeight:'600'}}>Saving...</span>
        </div>
      )}

      {trackingEnabled && (
        <div style={{position:'fixed',top:'1rem',right:'1rem',background:'#10b981',color:'white',padding:'0.75rem 1.25rem',borderRadius:'2rem',boxShadow:'0 4px 12px rgba(0,0,0,0.15)',zIndex:10001,display:'flex',gap:'0.75rem',alignItems:'center',fontSize:'0.875rem',fontWeight:'600'}}>
          <div style={{width:'12px',height:'12px',background:'white',borderRadius:'50%',animation:'pulse 2s infinite'}}></div>
          <span>GPS Active</span>
        </div>
      )}

      {!currentUser && (
        <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:10000,padding:'1rem'}}>
          <div style={{background:'white',borderRadius:'1rem',padding:'2rem',maxWidth:'400px',width:'100%',maxHeight:'80vh',overflowY:'auto'}}>
            <h2 style={{fontSize:'1.5rem',fontWeight:'bold',marginBottom:'0.5rem'}}>Select Your Profile</h2>
            <p style={{color:'#64748b',marginBottom:'1.5rem',fontSize:'0.875rem'}}>Choose your name to start tracking</p>
            <div style={{marginBottom:'1rem'}}>
              {teamMembers.map(member => (
                <div key={member.id} onClick={() => selectCurrentUser(member)} style={{padding:'1rem',marginBottom:'0.5rem',border:'2px solid #e2e8f0',borderRadius:'0.75rem',cursor:'pointer',display:'flex',alignItems:'center',gap:'1rem',transition:'border-color 0.2s'}} onMouseEnter={e => e.currentTarget.style.borderColor = member.color} onMouseLeave={e => e.currentTarget.style.borderColor = '#e2e8f0'}>
                  <div style={{width:'48px',height:'48px',borderRadius:'50%',background:member.color,display:'flex',alignItems:'center',justifyContent:'center',color:'white',fontWeight:'bold',fontSize:'1.25rem',flexShrink:0}}>
                    {member.name.charAt(0)}
                  </div>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontWeight:'600',fontSize:'1.125rem'}}>{member.name}</div>
                    <div style={{fontSize:'0.75rem',color:'#64748b'}}>{member.role}</div>
                  </div>
                </div>
              ))}
            </div>
            <button onClick={() => setShowUserModal(true)} style={{width:'100%',padding:'0.75rem',background:'#2563eb',color:'white',border:'none',borderRadius:'0.75rem',fontWeight:'600',cursor:'pointer',fontSize:'1rem'}}>
              ➕ Add New Member
            </button>
          </div>
        </div>
      )}

      {showUserModal && (
        <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:10002,padding:'1rem'}}>
          <div style={{background:'white',borderRadius:'1rem',padding:'2rem',maxWidth:'400px',width:'100%'}}>
            <h3 style={{fontSize:'1.25rem',fontWeight:'bold',marginBottom:'1rem'}}>Add Team Member</h3>
            <input value={newUserName} onChange={e => setNewUserName(e.target.value)} placeholder="Enter name" style={{width:'100%',padding:'0.75rem',border:'1px solid #cbd5e1',borderRadius:'0.5rem',marginBottom:'1rem',fontSize:'1rem'}} onKeyPress={e => e.key === 'Enter' && addTeamMember()} />
            <div style={{display:'flex',gap:'0.5rem'}}>
              <button onClick={addTeamMember} style={{flex:1,padding:'0.75rem',background:'#2563eb',color:'white',border:'none',borderRadius:'0.5rem',fontWeight:'600',cursor:'pointer'}}>Add</button>
              <button onClick={() => {setShowUserModal(false); setNewUserName("");}} style={{flex:1,padding:'0.75rem',background:'#e2e8f0',border:'none',borderRadius:'0.5rem',fontWeight:'600',cursor:'pointer'}}>Cancel</button>
            </div>
          </div>
        </div>
      )}

      {isMobile ? (
        <>
          <div style={{position:'absolute',top:0,left:0,right:0,bottom:0}}>
            <div ref={mapRef} style={{height:'100%',width:'100%'}}></div>
          </div>

          <div style={{position:'fixed',top:0,left:0,right:0,background:'white',padding:'0.75rem 1rem',boxShadow:'0 2px 8px rgba(0,0,0,0.1)',zIndex:999,display:'flex',alignItems:'center',justifyContent:'space-between'}}>
            <div style={{display:'flex',alignItems:'center',gap:'0.75rem'}}>
              <div style={{width:'40px',height:'40px',borderRadius:'50%',background:currentUser?.color || '#64748b',display:'flex',alignItems:'center',justifyContent:'center',color:'white',fontWeight:'bold',fontSize:'1.125rem',position:'relative'}}>
                {currentUser?.name?.charAt(0) || '?'}
                {trackingEnabled && (
                  <div style={{position:'absolute',top:'-4px',right:'-4px',width:'14px',height:'14px',background:'#10b981',border:'2px solid white',borderRadius:'50%'}}></div>
                )}
              </div>
              <div>
                <div style={{fontWeight:'600',fontSize:'0.875rem'}}>{currentUser?.name || 'Guest'}</div>
                <div style={{fontSize:'0.625rem',color:'#64748b'}}>
                  {stats.onlineUsers} online • {stats.verified} verified
                </div>
              </div>
            </div>
            <button onClick={() => setSidebarOpen(!sidebarOpen)} style={{padding:'0.5rem',background:'#f1f5f9',border:'none',borderRadius:'0.5rem',cursor:'pointer',fontSize:'1.25rem'}}>
              {sidebarOpen ? '✕' : '☰'}
            </button>
          </div>

          {sidebarOpen && (
            <div onClick={() => setSidebarOpen(false)} style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.3)',zIndex:1000}}>
              <div onClick={e => e.stopPropagation()} style={{position:'fixed',bottom:0,left:0,right:0,background:'white',borderTopLeftRadius:'1.5rem',borderTopRightRadius:'1.5rem',maxHeight:'85vh',overflowY:'auto',paddingBottom:'6rem'}}>
                <div style={{width:'40px',height:'4px',background:'#cbd5e1',borderRadius:'2px',margin:'1rem auto'}}></div>
                
                <div style={{display:'flex',borderBottom:'2px solid #e2e8f0',marginBottom:'1rem'}}>
                  {[['controls','🎮'],['leaderboard','🏆'],['live','📡']].map(([tab,icon]) => (
                    <button key={tab} onClick={() => setActiveTab(tab)} className={`tab ${activeTab === tab ? 'active' : ''}`} style={{flex:1,textAlign:'center'}}>
                      {icon}
                    </button>
                  ))}
                </div>

                <div style={{padding:'0 1.5rem'}}>
                  {activeTab === 'controls' && (
                    <>
                      <h2 style={{fontSize:'1.25rem',fontWeight:'bold',marginBottom:'1rem'}}>Controls</h2>

                      <div style={{marginBottom:'1.5rem',padding:'1rem',background:trackingEnabled?'#dcfce7':'#fee2e2',borderRadius:'1rem',border:`2px solid ${trackingEnabled?'#10b981':'#ef4444'}`}}>
                        <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'0.5rem'}}>
                          <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                            <span style={{fontSize:'1.5rem'}}>📍</span>
                            <b>GPS Tracking</b>
                          </div>
                          <button onClick={() => trackingEnabled ? stopLocationTracking() : requestLocationPermission(currentUser)} style={{padding:'0.5rem 1rem',background:trackingEnabled?'#ef4444':'#10b981',color:'white',border:'none',borderRadius:'0.5rem',fontWeight:'600',fontSize:'0.875rem',cursor:'pointer'}}>
                            {trackingEnabled ? 'Stop' : 'Start'}
                          </button>
                        </div>
                        <p style={{fontSize:'0.75rem',color:'#64748b'}}>
                          {trackingEnabled ? 'Your location is being tracked for verification' : 'Enable to verify pin locations'}
                        </p>
                      </div>

                      <div style={{marginBottom:'1.5rem'}}>
                        <label style={{display:'block',fontSize:'0.875rem',fontWeight:'600',marginBottom:'0.5rem'}}>Mode</label>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'0.5rem'}}>
                          {[['drop-pin','📍'],['draw-zone','✏️'],['select','👆']].map(([m,icon]) => (
                            <button key={m} onClick={()=>setMode(m)} style={{padding:'1rem 0.5rem',borderRadius:'0.75rem',border:'none',background:mode===m?'#2563eb':'#f1f5f9',color:mode===m?'white':'#475569',fontSize:'1.5rem',cursor:'pointer'}}>
                              {icon}
                            </button>
                          ))}
                        </div>
                      </div>

                      {mode === "drop-pin" && (
                        <div style={{padding:'1rem',background:'#dbeafe',borderRadius:'1rem',marginBottom:'1rem'}}>
                          <label style={{display:'block',fontSize:'0.875rem',fontWeight:'600',marginBottom:'0.75rem'}}>Status</label>
                          <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'0.5rem',marginBottom:'0.75rem'}}>
                            {[['knocked','✅','#16a34a'],['flyer','📬','#2563eb'],['skipped','⏭️','#ea580c']].map(([s,icon,color]) => (
                              <button key={s} onClick={()=>setStatus(s)} style={{padding:'1rem',borderRadius:'0.75rem',border:status===s?'none':'2px solid #bfdbfe',background:status===s?color:'white',color:status===s?'white':'#475569',fontSize:'1.5rem',cursor:'pointer'}}>
                                {icon}
                              </button>
                            ))}
                          </div>
                          <input value={note} onChange={e=>setNote(e.target.value)} placeholder="Note (gate code, dog, etc.)" style={{width:'100%',padding:'0.75rem',border:'2px solid #93c5fd',borderRadius:'0.75rem',fontSize:'1rem'}} />
                          {!trackingEnabled && (
                            <p style={{marginTop:'0.5rem',fontSize:'0.75rem',color:'#ef4444',fontWeight:'600'}}>⚠️ Enable GPS tracking to verify locations</p>
                          )}
                        </div>
                      )}

                      <div style={{padding:'1rem',background:'#f8fafc',borderRadius:'1rem',marginBottom:'1rem'}}>
                        <h3 style={{fontSize:'1rem',fontWeight:'600',marginBottom:'0.75rem'}}>Verification Stats</h3>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:'0.75rem'}}>
                          <div style={{textAlign:'center',padding:'0.75rem',background:'white',borderRadius:'0.5rem',border:'2px solid #10b981'}}>
                            <div style={{fontSize:'1.75rem',fontWeight:'bold',color:'#10b981'}}>{stats.verified}</div>
                            <div style={{fontSize:'0.75rem',color:'#64748b'}}>✅ Verified</div>
                          </div>
                          <div style={{textAlign:'center',padding:'0.75rem',background:'white',borderRadius:'0.5rem',border:'2px solid #ef4444'}}>
                            <div style={{fontSize:'1.75rem',fontWeight:'bold',color:'#ef4444'}}>{stats.suspicious}</div>
                            <div style={{fontSize:'0.75rem',color:'#64748b'}}>🚫 Suspicious</div>
                          </div>
                        </div>
                      </div>
                    </>
                  )}

                  {activeTab === 'leaderboard' && <LeaderboardView />}

                  {activeTab === 'live' && (
                    <div style={{padding:'1rem'}}>
                      <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'1rem'}}>
                        <h2 style={{fontSize:'1.25rem',fontWeight:'bold'}}>📡 Live Tracking</h2>
                        <button onClick={() => setShowLiveTracking(!showLiveTracking)} style={{padding:'0.5rem 1rem',background:showLiveTracking?'#10b981':'#e2e8f0',color:showLiveTracking?'white':'#64748b',border:'none',borderRadius:'0.5rem',fontWeight:'600',fontSize:'0.875rem',cursor:'pointer'}}>
                          {showLiveTracking ? 'Hide' : 'Show'}
                        </button>
                      </div>

                      <div style={{marginBottom:'1.5rem',padding:'1rem',background:'#f0fdf4',borderRadius:'1rem',border:'2px solid #10b981'}}>
                        <div style={{fontSize:'0.875rem',color:'#166534',marginBottom:'0.5rem'}}>
                          <b>{stats.onlineUsers} team member{stats.onlineUsers !== 1 ? 's' : ''} online</b>
                        </div>
                        <p style={{fontSize:'0.75rem',color:'#64748b'}}>
                          Active within the last 5 minutes
                        </p>
                      </div>

                      <h3 style={{fontSize:'1rem',fontWeight:'600',marginBottom:'0.75rem'}}>Team Members</h3>
                      <div style={{display:'flex',flexDirection:'column',gap:'0.75rem'}}>
                        {leaderboard.map(member => {
                          const isCurrentUser = member.id === currentUser?.id;
                          return (
                            <div key={member.id} style={{padding:'1rem',background:isCurrentUser?`${member.color}15`:'white',borderRadius:'0.75rem',border:`2px solid ${isCurrentUser?member.color:'#e2e8f0'}`,display:'flex',alignItems:'center',gap:'1rem'}}>
                              <div style={{width:'48px',height:'48px',borderRadius:'50%',background:member.color,display:'flex',alignItems:'center',justifyContent:'center',color:'white',fontWeight:'bold',fontSize:'1.25rem',position:'relative'}}>
                                {member.name.charAt(0)}
                                {member.isOnline && (
                                  <div style={{position:'absolute',top:'-4px',right:'-4px',width:'16px',height:'16px',background:'#10b981',border:'3px solid white',borderRadius:'50%'}}></div>
                                )}
                              </div>
                              <div style={{flex:1}}>
                                <div style={{fontWeight:'600',marginBottom:'0.25rem'}}>
                                  {member.name} {isCurrentUser && '(You)'}
                                </div>
                                {member.isOnline ? (
                                  <div style={{fontSize:'0.75rem',color:'#10b981',fontWeight:'600'}}>● ONLINE NOW</div>
                                ) : (
                                  <div style={{fontSize:'0.75rem',color:'#64748b'}}>Offline</div>
                                )}
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  <button onClick={() => setCurrentUser(null)} style={{width:'100%',padding:'1rem',background:'#ef4444',color:'white',border:'none',borderRadius:'0.75rem',fontWeight:'600',cursor:'pointer',fontSize:'1rem',marginTop:'1rem'}}>
                    Switch User
                  </button>
                </div>
              </div>
            </div>
          )}
        </>
      ) : (
        <div style={{display:'flex',height:'100%',gap:'1rem',padding:'1rem'}}>
          <div style={{width:'400px',background:'white',borderRadius:'0.75rem',boxShadow:'0 4px 6px rgba(0,0,0,0.1)',display:'flex',flexDirection:'column',overflow:'hidden'}}>
            <div style={{padding:'1.5rem',borderBottom:'1px solid #e2e8f0'}}>
              <h1 style={{fontSize:'1.75rem',fontWeight:'bold',marginBottom:'1rem'}}>RepZone Pro</h1>
              {currentUser && (
                <div style={{display:'flex',alignItems:'center',gap:'0.75rem',padding:'1rem',background:`${currentUser.color}15`,borderRadius:'0.75rem',border:`2px solid ${currentUser.color}`,marginBottom:'1rem'}}>
                  <div style={{width:'48px',height:'48px',borderRadius:'50%',background:currentUser.color,display:'flex',alignItems:'center',justifyContent:'center',color:'white',fontWeight:'bold',fontSize:'1.25rem',position:'relative'}}>
                    {currentUser.name.charAt(0)}
                    {trackingEnabled && (
                      <div style={{position:'absolute',top:'-4px',right:'-4px',width:'16px',height:'16px',background:'#10b981',border:'3px solid white',borderRadius:'50%'}}></div>
                    )}
                  </div>
                  <div style={{flex:1}}>
                    <div style={{fontWeight:'600'}}>{currentUser.name}</div>
                    <div style={{fontSize:'0.75rem',color:'#64748b'}}>
                      {trackingEnabled ? '📍 Tracking Active' : '📍 Tracking Off'}
                    </div>
                  </div>
                  <button onClick={() => setCurrentUser(null)} style={{padding:'0.5rem',fontSize:'0.75rem',background:'white',border:'1px solid #e2e8f0',borderRadius:'0.5rem',cursor:'pointer'}}>Switch</button>
                </div>
              )}

              <div style={{padding:'1rem',background:trackingEnabled?'#dcfce7':'#fee2e2',borderRadius:'0.75rem',border:`2px solid ${trackingEnabled?'#10b981':'#ef4444'}`}}>
                <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'0.5rem'}}>
                  <div style={{display:'flex',alignItems:'center',gap:'0.5rem'}}>
                    <span style={{fontSize:'1.25rem'}}>📍</span>
                    <b style={{fontSize:'0.875rem'}}>GPS Tracking</b>
                  </div>
                  <button onClick={() => trackingEnabled ? stopLocationTracking() : requestLocationPermission(currentUser)} style={{padding:'0.5rem 1rem',background:trackingEnabled?'#ef4444':'#10b981',color:'white',border:'none',borderRadius:'0.5rem',fontWeight:'600',fontSize:'0.75rem',cursor:'pointer'}}>
                    {trackingEnabled ? 'Stop' : 'Start'}
                  </button>
                </div>
                <p style={{fontSize:'0.75rem',color:'#64748b'}}>
                  {trackingEnabled ? 'Location verification active' : 'Enable to verify pins'}
                </p>
              </div>
            </div>

            <div style={{display:'flex',borderBottom:'2px solid #e2e8f0'}}>
              {[['map','🗺️'],['leaderboard','🏆'],['live','📡']].map(([tab,icon]) => (
                <button key={tab} onClick={() => setActiveTab(tab)} className={`tab ${activeTab === tab ? 'active' : ''}`} style={{flex:1,textAlign:'center'}}>
                  {icon}
                </button>
              ))}
            </div>

            <div style={{flex:1,overflowY:'auto',padding:'1rem'}}>
              {activeTab === 'map' && (
                <>
                  <div style={{marginBottom:'1.5rem'}}>
                    <label style={{display:'block',fontSize:'0.875rem',fontWeight:'600',marginBottom:'0.5rem'}}>Mode</label>
                    <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'0.5rem'}}>
                      {[['drop-pin','📍 Pin'],['draw-zone','✏️ Zone'],['select','👆 Select']].map(([m,label]) => (
                        <button key={m} onClick={()=>setMode(m)} style={{padding:'0.75rem 0.5rem',borderRadius:'0.5rem',border:'none',cursor:'pointer',background:mode===m?'#2563eb':'#f1f5f9',color:mode===m?'white':'#475569',fontSize:'0.875rem',fontWeight:'600'}}>
                          {label}
                        </button>
                      ))}
                    </div>
                  </div>

                  {mode === "drop-pin" && (
                    <div style={{padding:'1rem',background:'#dbeafe',borderRadius:'0.75rem',marginBottom:'1rem'}}>
                      <label style={{display:'block',fontSize:'0.875rem',fontWeight:'600',marginBottom:'0.75rem'}}>Status</label>
                      <div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'0.5rem',marginBottom:'0.75rem'}}>
                        {[['knocked','✅','#16a34a'],['flyer','📬','#2563eb'],['skipped','⏭️','#ea580c']].map(([s,icon,color]) => (
                          <button key={s} onClick={()=>setStatus(s)} style={{padding:'0.75rem',borderRadius:'0.5rem',border:status===s?'none':'2px solid #bfdbfe',background:status===s?color:'white',color:status===s?'white':'#475569',fontSize:'1.5rem',cursor:'pointer'}}>
                            {icon}
                          </button>
                        ))}
                      </div>
                      <input value={note} onChange={e=>setNote(e.target.value)} placeholder="Note" style={{width:'100%',padding:'0.75rem',border:'2px solid #93c5fd',borderRadius:'0.5rem',fontSize:'0.875rem'}} />
                      {!trackingEnabled && (
                        <p style={{marginTop:'0.5rem',fontSize:'0.75rem',color:'#ef4444',fontWeight:'600'}}>⚠️ Enable GPS to verify</p>
                      )}
                    </div>
                  )}

                  <div style={{padding:'1rem',background:'#f8fafc',borderRadius:'0.75rem'}}>
                    <h3 style={{fontSize:'1rem',fontWeight:'600',marginBottom:'0.75rem'}}>Verification</h3>
                    <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:'0.75rem',marginBottom:'1rem'}}>
                      <div style={{textAlign:'center',padding:'0.75rem',background:'white',borderRadius:'0.5rem',border:'2px solid #10b981'}}>
                        <div style={{fontSize:'1.5rem',fontWeight:'bold',color:'#10b981'}}>{stats.verified}</div>
                        <div style={{fontSize:'0.75rem',color:'#64748b'}}>✅ Verified</div>
                      </div>
                      <div style={{textAlign:'center',padding:'0.75rem',background:'white',borderRadius:'0.5rem',border:'2px solid #ef4444'}}>
                        <div style={{fontSize:'1.5rem',fontWeight:'bold',color:'#ef4444'}}>{stats.suspicious}</div>
                        <div style={{fontSize:'0.75rem',color:'#64748b'}}>🚫 Suspicious</div>
                      </div>
                    </div>
                    <div style={{fontSize:'0.875rem',color:'#64748b'}}>
                      📍 {stats.totalPins} total pins<br/>
                      🗺️ {zones.length} zones<br/>
                      👥 {stats.onlineUsers} online
                    </div>
                  </div>
                </>
              )}

              {activeTab === 'leaderboard' && <LeaderboardView />}

              {activeTab === 'live' && (
                <div style={{padding:'1rem'}}>
                  <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'1rem'}}>
                    <h2 style={{fontSize:'1.25rem',fontWeight:'bold'}}>📡 Live Tracking</h2>
                    <button onClick={() => setShowLiveTracking(!showLiveTracking)} style={{padding:'0.5rem 1rem',background:showLiveTracking?'#10b981':'#e2e8f0',color:showLiveTracking?'white':'#64748b',border:'none',borderRadius:'0.5rem',fontWeight:'600',fontSize:'0.875rem',cursor:'pointer'}}>
                      {showLiveTracking ? 'Showing' : 'Hidden'}
                    </button>
                  </div>

                  <div style={{marginBottom:'1.5rem',padding:'1rem',background:'#f0fdf4',borderRadius:'1rem',border:'2px solid #10b981'}}>
                    <div style={{fontSize:'1.5rem',fontWeight:'bold',color:'#10b981',marginBottom:'0.25rem'}}>
                      {stats.onlineUsers}
                    </div>
                    <div style={{fontSize:'0.875rem',color:'#166534',fontWeight:'600'}}>
                      Team members online
                    </div>
                  </div>

                  <div style={{display:'flex',flexDirection:'column',gap:'0.75rem'}}>
                    {leaderboard.map(member => {
                      const isCurrentUser = member.id === currentUser?.id;
                      return (
                        <div key={member.id} style={{padding:'1rem',background:isCurrentUser?`${member.color}15`:'white',borderRadius:'0.75rem',border:`2px solid ${isCurrentUser?member.color:'#e2e8f0'}`,display:'flex',alignItems:'center',gap:'1rem'}}>
                          <div style={{width:'48px',height:'48px',borderRadius:'50%',background:member.color,display:'flex',alignItems:'center',justifyContent:'center',color:'white',fontWeight:'bold',fontSize:'1.25rem',position:'relative'}}>
                            {member.name.charAt(0)}
                            {member.isOnline && (
                              <div style={{position:'absolute',top:'-4px',right:'-4px',width:'16px',height:'16px',background:'#10b981',border:'3px solid white',borderRadius:'50%'}}></div>
                            )}
                          </div>
                          <div style={{flex:1}}>
                            <div style={{fontWeight:'600',fontSize:'0.875rem',marginBottom:'0.25rem'}}>
                              {member.name} {isCurrentUser && '(You)'}
                            </div>
                            {member.isOnline ? (
                              <div style={{fontSize:'0.75rem',color:'#10b981',fontWeight:'600'}}>● ONLINE</div>
                            ) : (
                              <div style={{fontSize:'0.75rem',color:'#64748b'}}>Offline</div>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          </div>

          <div style={{flex:1,borderRadius:'0.75rem',overflow:'hidden',boxShadow:'0 4px 6px rgba(0,0,0,0.1)',position:'relative'}}>
            <div ref={mapRef} style={{height:'100%',width:'100%'}}></div>
          </div>
        </div>
      )}

      <div style={{position:'fixed',bottom:'1rem',right:'1rem',background:'white',padding:'0.5rem 1rem',borderRadius:'2rem',boxShadow:'0 2px 8px rgba(0,0,0,0.1)',fontSize:'0.75rem',color:'#10b981',fontWeight:'600',zIndex:998}}>
        ☁️ Synced • {stats.onlineUsers} online
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<RepZoneApp />);
</script>
</body>
</html>
