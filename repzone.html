<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>RepZone Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALxYqoe16YGS8s9wVO64jiKuI3hpkcvI0&libraries=places,geometry"></script>
<style>
  * { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
    -webkit-tap-highlight-color: transparent; 
  }
  
  html, body { 
    height: 100%; 
    width: 100%; 
    overflow: hidden; 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
    background: #0f172a;
  }

  #map { 
    height: 100% !important; 
    width: 100% !important; 
  }

  /* üé® SMOOTH ANIMATIONS */
  @keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  @keyframes slideInLeft {
    from { transform: translateX(-100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
  }

  @keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* üéØ MODERN COMPONENTS */
  .glass {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .dark-glass {
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .btn {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    font-weight: 600;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  }

  .btn:active {
    transform: translateY(0);
  }

  .card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
  }

  .card:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
  }

  /* üì± MOBILE OPTIMIZATIONS */
  .mobile-sheet {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-radius: 24px 24px 0 0;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    max-height: 70vh;
    overflow-y: auto;
  }

  .mobile-sheet.open {
    transform: translateY(0);
  }

  .mobile-handle {
    width: 40px;
    height: 5px;
    background: #cbd5e1;
    border-radius: 3px;
    margin: 12px auto;
  }

  /* üé® SCROLLBAR */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #f1f5f9;
  }

  ::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* üî• TOAST NOTIFICATIONS */
  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    z-index: 10000;
    animation: slideInRight 0.4s ease;
    max-width: 400px;
    border-left: 4px solid #3b82f6;
  }

  /* üí´ LOADING */
  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f4f6;
    border-top-color: #3b82f6;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  /* üéØ CUSTOM MARKER STYLES */
  .custom-marker {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    border: 4px solid white;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .custom-marker:hover {
    transform: scale(1.1);
  }

  /* üìä STATS CARD */
  .stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    border-radius: 16px;
    color: white;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  }

  /* üé® GRADIENT BACKGROUNDS */
  .gradient-blue {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .gradient-green {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  }

  .gradient-orange {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  }

  .gradient-red {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  }

  /* üåü GLOW EFFECTS */
  .glow {
    box-shadow: 0 0 20px currentColor;
  }

  /* üì± MOBILE MENU */
  .mobile-menu {
    position: fixed;
    top: 0;
    left: -100%;
    width: 85%;
    height: 100%;
    background: white;
    transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 2000;
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
  }

  .mobile-menu.open {
    left: 0;
  }

  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1999;
  }

  .overlay.show {
    opacity: 1;
    pointer-events: all;
  }

  /* üéØ FAB BUTTON */
  .fab {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 999;
  }

  .fab:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 30px rgba(102, 126, 234, 0.5);
  }

  .fab:active {
    transform: scale(0.95);
  }

  /* üé® LEAD TYPE BADGES */
  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
  }

  /* üìç GPS INDICATOR */
  .gps-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @media (max-width: 768px) {
    .toast {
      left: 16px;
      right: 16px;
      top: 16px;
      max-width: none;
    }
  }
</style>
</head>
<body>
<div id="root"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

// üîß CONFIG
const SUPABASE_URL = 'https://cytikhfyygkovnjtpsth.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5dGlraGZ5eWdrb3ZuanRwc3RoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTc3NzYsImV4cCI6MjA3NjI5Mzc3Nn0.ItJObIXo_Ks8TEigj5RkUA4vXbze_3FMMIzYyVHrthQ';

const COLORS = ["#ef4444", "#3b82f6", "#10b981", "#f59e0b", "#8b5cf6", "#ec4899"];

const LEAD_TYPES = {
  estimate: { icon: 'üí∞', label: 'A - Estimate', color: '#10b981', badge: 'A', shortLabel: 'Estimate' },
  callback: { icon: 'üìû', label: 'B - Callback', color: '#f59e0b', badge: 'B', shortLabel: 'Callback' },
  notinterested: { icon: 'üìã', label: 'C - Not Interested', color: '#64748b', badge: 'C', shortLabel: 'Not Int.' },
  flyer: { icon: 'üì¨', label: 'FD - Flyer Drop', color: '#3b82f6', badge: 'FD', shortLabel: 'Flyer' },
  knocked: { icon: '‚úÖ', label: 'Knocked', color: '#16a34a', badge: '‚úÖ', shortLabel: 'Knocked' },
  skipped: { icon: '‚è≠Ô∏è', label: 'Skipped', color: '#ef4444', badge: '‚è≠Ô∏è', shortLabel: 'Skipped' }
};

// üéØ UTILITY FUNCTIONS
function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371e3;
  const œÜ1 = lat1 * Math.PI / 180;
  const œÜ2 = lat2 * Math.PI / 180;
  const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
  const ŒîŒª = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) + Math.cos(œÜ1) * Math.cos(œÜ2) * Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c * 3.28084;
}

function getVerificationStatus(distance) {
  if (distance <= 50) return { status: 'verified', color: '#10b981', icon: '‚úÖ', label: 'Verified' };
  if (distance <= 150) return { status: 'questionable', color: '#f59e0b', icon: '‚ö†Ô∏è', label: 'Questionable' };
  return { status: 'suspicious', color: '#ef4444', icon: 'üö´', label: 'Suspicious' };
}

function RepZoneApp() {
  const [pins, setPins] = useState([]);
  const [teamMembers, setTeamMembers] = useState([]);
  const [currentUser, setCurrentUser] = useState(null);
  const [currentLocation, setCurrentLocation] = useState(null);
  const [mode, setMode] = useState("drop-pin");
  const [status, setStatus] = useState("estimate");
  const [note, setNote] = useState("");
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [trackingEnabled, setTrackingEnabled] = useState(false);
  const [showMobileMenu, setShowMobileMenu] = useState(false);
  const [showBottomSheet, setShowBottomSheet] = useState(false);
  const [toastMessage, setToastMessage] = useState(null);
  const [activeTab, setActiveTab] = useState('map');
  const [searchQuery, setSearchQuery] = useState('');
  const [customerName, setCustomerName] = useState('');
  const [customerPhone, setCustomerPhone] = useState('');
  const [customerEmail, setCustomerEmail] = useState('');
  const [showCustomerForm, setShowCustomerForm] = useState(false);
  const [pendingLocation, setPendingLocation] = useState(null);
  const [isMobile, setIsMobile] = useState(window.innerWidth < 768);

  const mapRef = useRef(null);
  const mapInstanceRef = useRef(null);
  const supabaseRef = useRef(null);
  const markersRef = useRef([]);
  const searchBoxRef = useRef(null);
  const locationWatchIdRef = useRef(null);

  // üé® SHOW TOAST
  const showToast = useCallback((message, duration = 4000) => {
    setToastMessage(message);
    setTimeout(() => setToastMessage(null), duration);
  }, []);

  // üì± DETECT MOBILE
  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth < 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // üîß INITIALIZE SUPABASE
  useEffect(() => {
    supabaseRef.current = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    loadData();

    const saved = localStorage.getItem('current_user_id');
    if (saved) {
      try {
        const user = JSON.parse(saved);
        setCurrentUser(user);
        requestLocationPermission(user);
      } catch (e) {
        console.error('Error loading user:', e);
      }
    }
  }, []);

  // üó∫Ô∏è INITIALIZE GOOGLE MAPS
  useEffect(() => {
    if (!mapRef.current || mapInstanceRef.current || loading) return;

    const map = new google.maps.Map(mapRef.current, {
      center: { lat: 47.6062, lng: -122.3321 },
      zoom: 13,
      styles: [
        {
          featureType: "poi",
          elementType: "labels",
          stylers: [{ visibility: "off" }]
        }
      ],
      mapTypeControl: false,
      streetViewControl: false,
      fullscreenControl: false,
      zoomControl: true
    });

    mapInstanceRef.current = map;

    // üìç ADD CLICK LISTENER
    map.addListener('click', (e) => handleMapClick(e.latLng));

    // üîç SEARCH BOX
    if (searchBoxRef.current) {
      const searchBox = new google.maps.places.SearchBox(searchBoxRef.current);
      map.addListener('bounds_changed', () => {
        searchBox.setBounds(map.getBounds());
      });

      searchBox.addListener('places_changed', () => {
        const places = searchBox.getPlaces();
        if (places.length === 0) return;

        const place = places[0];
        if (!place.geometry || !place.geometry.location) return;

        map.setCenter(place.geometry.location);
        map.setZoom(17);
      });
    }

    // üìç CENTER ON USER LOCATION
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          map.setCenter(pos);
          map.setZoom(16);
          setCurrentLocation({ lat: pos.lat, lng: pos.lng, timestamp: Date.now() });
        },
        () => {
          console.log('Location permission denied');
        }
      );
    }
  }, [loading]);

  // üéØ HANDLE MAP CLICK
  const handleMapClick = useCallback((latLng) => {
    if (mode === "drop-pin" && currentUser) {
      if (!currentLocation) {
        showToast('‚ö†Ô∏è Enable GPS tracking first!');
        return;
      }

      if (status === 'flyer') {
        // Instant flyer drop
        dropPinAtLocation(latLng.lat(), latLng.lng(), '', '', '', '');
      } else {
        // Show customer form
        setPendingLocation({ lat: latLng.lat(), lng: latLng.lng() });
        setShowCustomerForm(true);
      }
    }
  }, [mode, currentUser, currentLocation, status]);

  // üì• LOAD DATA
  async function loadData() {
    try {
      const [pinsRes, teamRes] = await Promise.all([
        supabaseRef.current.from('pins').select('*'),
        supabaseRef.current.from('team_members').select('*')
      ]);

      setPins(pinsRes.data || []);
      setTeamMembers(teamRes.data || []);
    } catch (e) {
      console.error('Load error:', e);
    }
    setLoading(false);
  }

  // üìç DROP PIN
  async function dropPinAtLocation(lat, lng, name, phone, email, noteText) {
    setSaving(true);

    try {
      // üè† REVERSE GEOCODE
      const geocoder = new google.maps.Geocoder();
      const result = await new Promise((resolve) => {
        geocoder.geocode({ location: { lat, lng } }, (results, status) => {
          if (status === 'OK' && results[0]) {
            resolve(results[0].formatted_address);
          } else {
            resolve(null);
          }
        });
      });

      const distance = calculateDistance(currentLocation.lat, currentLocation.lng, lat, lng);
      const verification = getVerificationStatus(distance);

      let finalNote = noteText || note || null;
      if (name) {
        let noteParts = `${name}${email ? ' - ' + email : ''}${phone ? ' - ' + phone : ''}`;
        if (noteText || note) {
          noteParts += ' | ' + [noteText, note].filter(Boolean).join(' | ');
        }
        finalNote = noteParts;
      }

      const newPin = {
        id: `pin-${Date.now()}`,
        lat,
        lng,
        status,
        address: result,
        rep_name: currentUser.name,
        team_member_id: currentUser.id,
        note: finalNote,
        actual_lat: currentLocation.lat,
        actual_lng: currentLocation.lng,
        distance_from_pin: Math.round(distance),
        verification_status: verification.status,
        created_at: new Date().toISOString()
      };

      const { data, error } = await supabaseRef.current.from('pins').insert([newPin]).select();

      if (error) {
        showToast('‚ùå Error: ' + error.message);
      } else {
        setPins(prev => [...prev, newPin]);
        setNote("");
        const leadType = LEAD_TYPES[status];
        showToast(`‚úÖ ${leadType.label} dropped! (${Math.round(distance)}ft)`);

        // Add marker to map
        addMarkerToMap(newPin);
      }
    } catch (error) {
      showToast('‚ùå Error: ' + error.message);
    }

    setSaving(false);
    setShowCustomerForm(false);
    setPendingLocation(null);
    setCustomerName('');
    setCustomerPhone('');
    setCustomerEmail('');
  }

  // üó∫Ô∏è ADD MARKER TO MAP
  function addMarkerToMap(pin) {
    if (!mapInstanceRef.current) return;

    const leadType = LEAD_TYPES[pin.status] || LEAD_TYPES.knocked;
    const user = teamMembers.find(u => u.id === pin.team_member_id);
    const verification = pin.verification_status ? getVerificationStatus(pin.distance_from_pin || 0) : null;

    const marker = new google.maps.Marker({
      position: { lat: pin.lat, lng: pin.lng },
      map: mapInstanceRef.current,
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 12,
        fillColor: user?.color || '#64748b',
        fillOpacity: 1,
        strokeColor: verification ? verification.color : 'white',
        strokeWeight: 4
      },
      title: leadType.label
    });

    // INFO WINDOW
    const infoWindow = new google.maps.InfoWindow({
      content: `
        <div style="padding: 12px; font-family: -apple-system, sans-serif; min-width: 200px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <span style="font-size: 24px;">${leadType.icon}</span>
            <strong style="font-size: 16px;">${leadType.label}</strong>
          </div>
          ${pin.address ? `<p style="margin: 8px 0; font-size: 13px; color: #64748b;">üìç ${pin.address}</p>` : ''}
          <p style="margin: 4px 0; font-size: 13px;"><strong>Rep:</strong> ${pin.rep_name}</p>
          ${verification ? `<p style="margin: 4px 0; font-size: 13px; color: ${verification.color};">${verification.icon} ${verification.label} (${pin.distance_from_pin}ft)</p>` : ''}
          ${pin.note ? `<p style="margin: 8px 0; font-size: 13px; padding: 8px; background: #f8fafc; border-radius: 6px;">${pin.note}</p>` : ''}
          <button onclick="window.deletePinGlobal('${pin.id}')" style="margin-top: 8px; width: 100%; padding: 8px; background: #ef4444; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">üóëÔ∏è Delete</button>
        </div>
      `
    });

    marker.addListener('click', () => {
      infoWindow.open(mapInstanceRef.current, marker);
    });

    markersRef.current.push(marker);
  }

  // üó∫Ô∏è RENDER MARKERS
  useEffect(() => {
    if (!mapInstanceRef.current || pins.length === 0) return;

    // Clear existing markers
    markersRef.current.forEach(marker => marker.setMap(null));
    markersRef.current = [];

    // Add all pins
    pins.forEach(pin => addMarkerToMap(pin));
  }, [pins, teamMembers]);

  // üóëÔ∏è DELETE PIN
  window.deletePinGlobal = async (pinId) => {
    if (!confirm('Delete this pin?')) return;

    try {
      await supabaseRef.current.from('pins').delete().eq('id', pinId);
      setPins(prev => prev.filter(p => p.id !== pinId));
      showToast('‚úÖ Pin deleted!');
      
      // Remove marker
      const markerIndex = markersRef.current.findIndex(m => m.title === pinId);
      if (markerIndex !== -1) {
        markersRef.current[markerIndex].setMap(null);
        markersRef.current.splice(markerIndex, 1);
      }
    } catch (e) {
      showToast('‚ùå Error deleting pin');
    }
  };

  // üìç GPS TRACKING
  function requestLocationPermission(user) {
    if (!navigator.geolocation) return;

    locationWatchIdRef.current = navigator.geolocation.watchPosition(
      (position) => {
        setCurrentLocation({
          lat: position.coords.latitude,
          lng: position.coords.longitude,
          accuracy: position.coords.accuracy,
          timestamp: Date.now()
        });
      },
      () => {},
      { enableHighAccuracy: true, maximumAge: 10000, timeout: 5000 }
    );

    setTrackingEnabled(true);
  }

  function stopLocationTracking() {
    if (locationWatchIdRef.current) {
      navigator.geolocation.clearWatch(locationWatchIdRef.current);
      locationWatchIdRef.current = null;
    }
    setTrackingEnabled(false);
  }

  // üìä STATS
  const stats = {
    total: currentUser ? pins.filter(p => p.team_member_id === currentUser.id).length : 0,
    estimates: currentUser ? pins.filter(p => p.team_member_id === currentUser.id && p.status === 'estimate').length : 0,
    callbacks: currentUser ? pins.filter(p => p.team_member_id === currentUser.id && p.status === 'callback').length : 0,
    verified: currentUser ? pins.filter(p => p.team_member_id === currentUser.id && p.verification_status === 'verified').length : 0
  };

  // üîÑ LOADING SCREEN
  if (loading) {
    return (
      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh', flexDirection: 'column', gap: '24px', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ fontSize: '80px', animation: 'pulse 1.5s infinite' }}>üè†</div>
        <h1 style={{ color: 'white', fontSize: '48px', fontWeight: 'bold' }}>RepZone Pro</h1>
        <div className="spinner"></div>
      </div>
    );
  }

  // üö´ NO USER SELECTED
  if (!currentUser) {
    return (
      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh', padding: '20px', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div className="glass" style={{ maxWidth: '500px', width: '100%', padding: '40px', borderRadius: '24px', animation: 'fadeIn 0.5s ease' }}>
          <h2 style={{ fontSize: '32px', fontWeight: 'bold', marginBottom: '12px', textAlign: 'center' }}>üëã Welcome to RepZone</h2>
          <p style={{ color: '#64748b', marginBottom: '32px', textAlign: 'center', fontSize: '16px' }}>Select your profile to start tracking</p>
          
          <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
            {teamMembers.map(member => (
              <div
                key={member.id}
                onClick={() => {
                  setCurrentUser(member);
                  localStorage.setItem('current_user_id', JSON.stringify(member));
                  requestLocationPermission(member);
                }}
                className="card btn"
                style={{ display: 'flex', alignItems: 'center', gap: '16px', padding: '20px', cursor: 'pointer' }}
              >
                <div style={{ width: '64px', height: '64px', borderRadius: '50%', background: member.color, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '28px', fontWeight: 'bold', flexShrink: 0 }}>
                  {member.name.charAt(0)}
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#1e293b' }}>{member.name}</div>
                  <div style={{ fontSize: '14px', color: '#64748b', fontWeight: '600' }}>{member.role}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  return (
    <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0 }}>
      {/* üçû TOAST */}
      {toastMessage && (
        <div className="toast">
          <div style={{ fontWeight: '600', fontSize: '15px' }}>{toastMessage}</div>
        </div>
      )}

      {/* üíæ SAVING OVERLAY */}
      {saving && (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10000 }}>
          <div className="glass" style={{ padding: '40px', borderRadius: '20px', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '20px' }}>
            <div className="spinner"></div>
            <div style={{ fontSize: '18px', fontWeight: 'bold' }}>Dropping Pin...</div>
          </div>
        </div>
      )}

      {/* üìã CUSTOMER FORM */}
      {showCustomerForm && pendingLocation && (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.6)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10001, padding: '20px' }}>
          <div className="glass" style={{ maxWidth: '500px', width: '100%', padding: '32px', borderRadius: '24px', animation: 'fadeIn 0.3s ease' }}>
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '24px' }}>
              <h3 style={{ fontSize: '24px', fontWeight: 'bold' }}>üìã Customer Info</h3>
              <button onClick={() => { setShowCustomerForm(false); setPendingLocation(null); }} className="btn" style={{ width: '40px', height: '40px', borderRadius: '50%', border: 'none', background: '#f1f5f9', fontSize: '24px' }}>√ó</button>
            </div>

            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              <input
                value={customerName}
                onChange={(e) => setCustomerName(e.target.value)}
                placeholder="Customer Name"
                autoFocus
                style={{ padding: '14px', border: '2px solid #e5e7eb', borderRadius: '12px', fontSize: '16px', fontWeight: '600' }}
              />
              <input
                value={customerEmail}
                onChange={(e) => setCustomerEmail(e.target.value)}
                placeholder="Email (optional)"
                type="email"
                style={{ padding: '14px', border: '2px solid #e5e7eb', borderRadius: '12px', fontSize: '16px', fontWeight: '600' }}
              />
              <input
                value={customerPhone}
                onChange={(e) => setCustomerPhone(e.target.value)}
                placeholder="Phone (optional)"
                style={{ padding: '14px', border: '2px solid #e5e7eb', borderRadius: '12px', fontSize: '16px', fontWeight: '600' }}
              />
              <textarea
                value={note}
                onChange={(e) => setNote(e.target.value)}
                placeholder="Note (optional)"
                rows={2}
                style={{ padding: '14px', border: '2px solid #e5e7eb', borderRadius: '12px', fontSize: '16px', fontWeight: '600', resize: 'vertical', fontFamily: '-apple-system, sans-serif' }}
              />
            </div>

            <button
              onClick={() => dropPinAtLocation(pendingLocation.lat, pendingLocation.lng, customerName, customerPhone, customerEmail, note)}
              className="btn gradient-blue"
              style={{ width: '100%', marginTop: '24px', padding: '16px', border: 'none', borderRadius: '12px', color: 'white', fontSize: '18px', fontWeight: 'bold' }}
            >
              üìç Drop Pin
            </button>
          </div>
        </div>
      )}

      {/* üì± MOBILE MENU */}
      <div className={`overlay ${showMobileMenu ? 'show' : ''}`} onClick={() => setShowMobileMenu(false)}></div>
      <div className={`mobile-menu ${showMobileMenu ? 'open' : ''}`}>
        <div style={{ padding: '24px' }}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'between', marginBottom: '24px' }}>
            <h2 style={{ fontSize: '24px', fontWeight: 'bold' }}>Menu</h2>
            <button onClick={() => setShowMobileMenu(false)} className="btn" style={{ padding: '8px 16px', background: '#f1f5f9', border: 'none', borderRadius: '8px', fontWeight: '600' }}>Close</button>
          </div>

          {/* USER INFO */}
          <div className="card" style={{ padding: '20px', marginBottom: '24px', background: `${currentUser.color}15`, border: `2px solid ${currentUser.color}` }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
              <div style={{ width: '56px', height: '56px', borderRadius: '50%', background: currentUser.color, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '24px', fontWeight: 'bold' }}>
                {currentUser.name.charAt(0)}
              </div>
              <div>
                <div style={{ fontSize: '18px', fontWeight: 'bold' }}>{currentUser.name}</div>
                <div style={{ fontSize: '14px', color: '#64748b', fontWeight: '600' }}>{currentUser.role}</div>
              </div>
            </div>
          </div>

          {/* STATS */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '12px', marginBottom: '24px' }}>
            <div className="card" style={{ padding: '16px', textAlign: 'center', background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', color: 'white' }}>
              <div style={{ fontSize: '32px', fontWeight: 'bold' }}>{stats.estimates}</div>
              <div style={{ fontSize: '14px', marginTop: '4px' }}>Estimates</div>
            </div>
            <div className="card" style={{ padding: '16px', textAlign: 'center', background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)', color: 'white' }}>
              <div style={{ fontSize: '32px', fontWeight: 'bold' }}>{stats.callbacks}</div>
              <div style={{ fontSize: '14px', marginTop: '4px' }}>Callbacks</div>
            </div>
          </div>

          {/* GPS */}
          <div className="card" style={{ padding: '20px', marginBottom: '16px', background: trackingEnabled ? '#dcfce7' : '#fee2e2', border: `2px solid ${trackingEnabled ? '#10b981' : '#ef4444'}` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
              <strong>üìç GPS Tracking</strong>
              <button
                onClick={() => trackingEnabled ? stopLocationTracking() : requestLocationPermission(currentUser)}
                className="btn"
                style={{ padding: '8px 16px', background: trackingEnabled ? '#ef4444' : '#10b981', color: 'white', border: 'none', borderRadius: '8px', fontSize: '14px' }}
              >
                {trackingEnabled ? 'Stop' : 'Start'}
              </button>
            </div>
            <div style={{ fontSize: '14px', color: '#64748b', fontWeight: '600' }}>
              {trackingEnabled ? '‚úÖ Active' : '‚ö†Ô∏è Enable to verify pins'}
            </div>
          </div>

          {/* SWITCH USER */}
          <button
            onClick={() => {
              setCurrentUser(null);
              localStorage.removeItem('current_user_id');
            }}
            className="btn"
            style={{ width: '100%', padding: '16px', background: '#e5e7eb', border: 'none', borderRadius: '12px', fontSize: '16px', fontWeight: 'bold' }}
          >
            üîÑ Switch User
          </button>
        </div>
      </div>

      {/* üéØ DESKTOP SIDEBAR */}
      {!isMobile && (
        <div style={{ position: 'fixed', top: '20px', left: '20px', width: '380px', maxHeight: 'calc(100vh - 40px)', display: 'flex', flexDirection: 'column', gap: '16px', zIndex: 1000 }}>
          {/* HEADER */}
          <div className="glass" style={{ padding: '24px', borderRadius: '20px' }}>
            <h1 style={{ fontSize: '28px', fontWeight: 'bold', marginBottom: '8px' }}>üè† RepZone Pro</h1>
            <p style={{ color: '#64748b', fontSize: '14px', fontWeight: '600' }}>Door Knocking Tracker</p>
          </div>

          {/* USER CARD */}
          <div className="glass" style={{ padding: '20px', borderRadius: '20px' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
              <div style={{ width: '56px', height: '56px', borderRadius: '50%', background: currentUser.color, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '24px', fontWeight: 'bold' }}>
                {currentUser.name.charAt(0)}
              </div>
              <div style={{ flex: 1 }}>
                <div style={{ fontSize: '18px', fontWeight: 'bold' }}>{currentUser.name}</div>
                <div style={{ fontSize: '14px', color: '#64748b', fontWeight: '600' }}>{currentUser.role}</div>
              </div>
            </div>

            {/* QUICK STATS */}
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '8px' }}>
              <div style={{ padding: '12px', background: '#10b98115', border: '2px solid #10b981', borderRadius: '12px', textAlign: 'center' }}>
                <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#10b981' }}>{stats.estimates}</div>
                <div style={{ fontSize: '12px', color: '#64748b', marginTop: '2px' }}>Estimates</div>
              </div>
              <div style={{ padding: '12px', background: '#f59e0b15', border: '2px solid #f59e0b', borderRadius: '12px', textAlign: 'center' }}>
                <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#f59e0b' }}>{stats.callbacks}</div>
                <div style={{ fontSize: '12px', color: '#64748b', marginTop: '2px' }}>Callbacks</div>
              </div>
            </div>
          </div>

          {/* SEARCH */}
          <div className="glass" style={{ padding: '20px', borderRadius: '20px' }}>
            <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '8px' }}>üîç Search Address</label>
            <input
              ref={searchBoxRef}
              type="text"
              placeholder="Search for a place..."
              style={{ width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '12px', fontSize: '15px', fontWeight: '600' }}
            />
          </div>

          {/* MODE SELECTOR */}
          <div className="glass" style={{ padding: '20px', borderRadius: '20px' }}>
            <label style={{ display: 'block', fontSize: '14px', fontWeight: 'bold', marginBottom: '12px' }}>üéØ Lead Type</label>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '8px' }}>
              {['estimate', 'callback', 'notinterested', 'flyer'].map(type => {
                const lead = LEAD_TYPES[type];
                return (
                  <button
                    key={type}
                    onClick={() => setStatus(type)}
                    className="btn"
                    style={{
                      padding: '16px 12px',
                      borderRadius: '12px',
                      border: status === type ? 'none' : '2px solid #e5e7eb',
                      background: status === type ? lead.color : 'white',
                      color: status === type ? 'white' : '#64748b',
                      fontSize: '24px',
                      display: 'flex',
                      flexDirection: 'column',
                      alignItems: 'center',
                      gap: '4px'
                    }}
                  >
                    <div>{lead.icon}</div>
                    <div style={{ fontSize: '12px', fontWeight: 'bold' }}>{lead.badge}</div>
                  </button>
                );
              })}
            </div>
          </div>

          {/* GPS STATUS */}
          <div className="glass" style={{ padding: '20px', borderRadius: '20px', background: trackingEnabled ? '#dcfce7' : '#fee2e2', border: `2px solid ${trackingEnabled ? '#10b981' : '#ef4444'}` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
              <strong style={{ fontSize: '14px' }}>üìç GPS Tracking</strong>
              <button
                onClick={() => trackingEnabled ? stopLocationTracking() : requestLocationPermission(currentUser)}
                className="btn"
                style={{ padding: '8px 16px', background: trackingEnabled ? '#ef4444' : '#10b981', color: 'white', border: 'none', borderRadius: '8px', fontSize: '14px' }}
              >
                {trackingEnabled ? 'Stop' : 'Start'}
              </button>
            </div>
            <div style={{ fontSize: '13px', color: '#64748b', fontWeight: '600' }}>
              {trackingEnabled ? '‚úÖ Location tracking active' : '‚ö†Ô∏è Enable to verify pin locations'}
            </div>
          </div>
        </div>
      )}

      {/* üì± MOBILE HAMBURGER */}
      {isMobile && (
        <button
          onClick={() => setShowMobileMenu(true)}
          className="btn"
          style={{ position: 'fixed', top: '16px', left: '16px', width: '56px', height: '56px', borderRadius: '50%', background: 'white', border: 'none', fontSize: '24px', boxShadow: '0 4px 12px rgba(0,0,0,0.15)', zIndex: 999 }}
        >
          ‚ò∞
        </button>
      )}

      {/* üó∫Ô∏è MAP */}
      <div ref={mapRef} style={{ width: '100%', height: '100%' }}></div>

      {/* üìç GPS INDICATOR */}
      {trackingEnabled && (
        <div style={{ position: 'fixed', top: isMobile ? '16px' : '20px', right: isMobile ? '16px' : '20px', background: '#10b981', color: 'white', padding: '12px 20px', borderRadius: '24px', boxShadow: '0 4px 12px rgba(16, 185, 129, 0.4)', zIndex: 999, display: 'flex', alignItems: 'center', gap: '8px', fontWeight: 'bold', fontSize: '14px' }}>
          <div className="gps-pulse" style={{ width: '12px', height: '12px', background: 'white', borderRadius: '50%' }}></div>
          GPS Active
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<RepZoneApp />);
</script>
</body>
</html>
